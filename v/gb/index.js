(function(n){var s=document.getElementById("favor-list"),q=document.getElementById("bulletin"),o=document.getElementById("morepost"),j=s.firstChild,e=s.parentNode;var h="",g="jsdemo",f="sinaapp",c="";o.setAttribute("data",30);var i=document.querySelector(".newpost"),m,r;i=i.cloneNode(true);m=i.querySelector("button");r=i.querySelector("textarea");r.setAttribute("placeholder","写回帖 留言");m.id="replybtn";m.innerHTML="留 言";h=[g,f,"com"].join(".");e.addEventListener("click",b);o.addEventListener("click",function(t){var u=parseInt(o.getAttribute("data"),10);o.setAttribute("data",u+10);k(u,10)});s.addEventListener("click",a);c="http://"+h+"/jsonp/";function l(v,u){var t=c+"?welcome="+v+","+u;nfc.ajxget(t,function(A){if(A!=="null"&&A!==undefined){var z=JSON.parse(A),w=z.length,y=0,x="";for(y=0;y<w;++y){x+="<pre>"+z[y].txt+"</pre>"}q.innerHTML=x}})}function k(v,u){var t=c+"?msg="+v+","+u;nfc.ajxget(t,function(B){if(B!=="null"&&B!==undefined){var A=JSON.parse(B),w=A.length,y=0,x="",z=null;if(w===0){return}for(y=0;y<w;++y){x+='<pre class="post" id="'+A[y].id+'">'+A[y].favor+'<span style="color:blue">~联系我:)</span><br><span></span><div class="reply"></div></pre>'}s.innerHTML+=x}})}function p(t,w,v){var u=c+"?pid="+t.id+"&reply="+w+","+v;nfc.ajxget(u,function(D){if(D!=="null"&&D!==undefined){var C=JSON.parse(D),x=C.length,z=0,y="",A=null;if(x===0){return}var B=t.querySelector("div");B.innerHTML="";for(z=0;z<x;++z){y+='<pre id="'+C[z].pid+"-"+C[z].id+'">'+C[z].favor+"</pre>"}B.innerHTML+=y}})}function b(y){var w=y.target,v=false;if(w.tagName==="BUTTON"&&w.className==="mania"){var u=c+"?cmd=new",A=w.parentNode,x=A.querySelector(".hobby"),z=x.value;if(z.length<3){return}if(w.id==="replybtn"){v=true;u=c+"?cmd=reply&pid="+w.getAttribute("data")}nfc.ajxpost(u,z,function(B){if(B!=="null"&&B!==undefined){var t=document.createElement("pre");t.innerHTML=B;if(s.childNodes.length>0){if(v){s.insertBefore(t,A)}else{s.insertBefore(t,s.firstChild)}}else{s.appendChild(t)}}});x.value=""}}function a(v){var u=v.target;if(u.tagName==="SPAN"){u=u.parentNode}if(u.tagName!=="PRE"||u.id===""){return}var w=u.parentNode;if(u.nextSibling===null){w.appendChild(i)}else{w.insertBefore(i,u.nextSibling)}m.setAttribute("data",u.id);d(u);p(u,0,10)}function d(t){var u=c+"?rcount="+t.id;nfc.ajxget(u,function(w){var v=JSON.parse(w),x=parseInt(v[0].count,10);if(x>0){t.setAttribute("rcount",x);t.querySelector("span").innerHTML="回复："+x}else{}})}l(0,1);k(0,30)})(window);